<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Cloud Speech-to-Text API • googleLanguageR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Google Cloud Speech-to-Text API">
<meta property="og:description" content="googleLanguageR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleLanguageR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/translation.html">
    <span class="fa fa-globe fa-lg"></span>
     
    Translation API
  </a>
</li>
<li>
  <a href="../articles/nlp.html">
    <span class="fa fa-object-group fa-lg"></span>
     
    NLP API
  </a>
</li>
<li>
  <a href="../articles/speech.html">
    <span class="fa fa-comment fa-lg"></span>
     
    Speech API
  </a>
</li>
<li>
  <a href="../articles/text-to-speech.html">
    <span class="fa fa-phone fa-lg"></span>
     
    Text-to-Speech API
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">
        <span class="fa fa-info"></span>
         
        Function Reference
      </a>
    </li>
    <li>
      <a href="https://cloud.google.com/products/machine-learning/">
        <span class="fa fa-google"></span>
         
        Google Documentation
      </a>
    </li>
    <li>
      <a href="https://github.com/ropensci/googleLanguageR">
        <span class="fa fa-github"></span>
         
        Development site
      </a>
    </li>
    <li>
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSerjirmMpB3b7LmBs_Vx_XPIE9IrhpCpPg1jUcpfBcivA3uBw/viewform">
        <span class="fa fa-slack"></span>
         
        Slack Support Channel
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/googleLanguageR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Google Cloud Speech-to-Text API</h1>
                        <h4 class="author">Mark Edmondson</h4>
            
            <h4 class="date">2020-04-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/googleLanguageR/blob/master/vignettes/speech.Rmd"><code>vignettes/speech.Rmd</code></a></small>
      <div class="hidden name"><code>speech.Rmd</code></div>

    </div>

    
    
<p>The Google Cloud Speech-to-Text API enables you to convert audio to text by applying neural network models in an easy to use API. The API recognizes over 80 languages and variants, to support your global user base. You can transcribe the text of users dictating to an application’s microphone or enable command-and-control through voice among many other use cases.</p>
<p>Read more <a href="https://cloud.google.com/speech/">on the Google Cloud Speech-to-Text Website</a></p>
<p>The Cloud Speech API provides audio transcription. Its accessible via the <code>gl_speech</code> function.</p>
<p>Arguments include:</p>
<ul>
<li>
<code>audio_source</code> - this is a local file in the correct format, or a Google Cloud Storage URI. This can also be a <code>Wave</code> class object from the package <code>tuneR</code>
</li>
<li>
<code>encoding</code> - the format of the sound file - <code>LINEAR16</code> is the common <code>.wav</code> format, other formats include <code>FLAC</code> and <code>OGG_OPUS</code>
</li>
<li>
<code>sampleRate</code> - this needs to be set to what your file is recorded at.<br>
</li>
<li>
<code>languageCode</code> - specify the language spoken as a <a href="https://tools.ietf.org/html/bcp47"><code>BCP-47</code> language tag</a>
</li>
<li>
<code>speechContexts</code> - you can supply keywords to help the translation with some context.</li>
</ul>
<div id="returned-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#returned-structure" class="anchor"></a>Returned structure</h3>
<p>The API returns a list of two data.frame tibbles - <code>transcript</code> and <code>timings</code>.</p>
<p>Access them via the returned object and <code>$transcript</code> and <code>$timings</code></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">return</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>, <span class="kw">languageCode</span> <span class="kw">=</span> <span class="st">"en-GB"</span>)

<span class="no">return</span>$<span class="no">transcript</span>
<span class="co"># A tibble: 1 x 2</span>
<span class="co">#                                                                                                         transcript confidence</span>
<span class="co">#                                                                                                              &lt;chr&gt;      &lt;chr&gt;</span>
<span class="co">#1 to administer medicine to animals is frequently a very difficult matter and yet sometimes it's necessary to do so  0.9711006</span>

<span class="no">return</span>$<span class="no">timings</span>
<span class="co">#   startTime endTime       word</span>
<span class="co">#1         0s  0.100s         to</span>
<span class="co">#2     0.100s  0.700s administer</span>
<span class="co">#3     0.700s  0.700s   medicine</span>
<span class="co">#4     0.700s  1.200s         to</span>
<span class="co"># etc...</span></pre></body></html></div>
</div>
<div id="demo-for-google-cloud-speech-to-text-api" class="section level3">
<h3 class="hasAnchor">
<a href="#demo-for-google-cloud-speech-to-text-api" class="anchor"></a>Demo for Google Cloud Speech-to-Text API</h3>
<p>A test audio file is installed with the package which reads:</p>
<blockquote>
<p>“To administer medicine to animals is frequently a very difficult matter, and yet sometimes it’s necessary to do so”</p>
</blockquote>
<p>The file is sourced from the University of Southampton’s speech detection (<code>http://www-mobile.ecs.soton.ac.uk/</code>) group and is fairly difficult for computers to parse, as we see below:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">googleLanguageR</span>)
<span class="co">## get the sample source file</span>
<span class="no">test_audio</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"woman1_wb.wav"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"googleLanguageR"</span>)

<span class="co">## its not perfect but...:)</span>
<span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>)$<span class="no">transcript</span>

<span class="co">## get alternative transcriptions</span>
<span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>, <span class="kw">maxAlternatives</span> <span class="kw">=</span> <span class="fl">2L</span>)$<span class="no">transcript</span>

<span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>, <span class="kw">languageCode</span> <span class="kw">=</span> <span class="st">"en-GB"</span>)$<span class="no">transcript</span>

<span class="co">## help it out with context for "frequently"</span>
<span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>,
            <span class="kw">languageCode</span> <span class="kw">=</span> <span class="st">"en-GB"</span>,
            <span class="kw">speechContexts</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">phrases</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"is frequently a very difficult"</span>)))$<span class="no">transcript</span></pre></body></html></div>
</div>
<div id="word-transcripts" class="section level3">
<h3 class="hasAnchor">
<a href="#word-transcripts" class="anchor"></a>Word transcripts</h3>
<p>The API <a href="https://cloud.google.com/speech/reference/rest/v1/speech/recognize#WordInfo">supports timestamps</a> on when words are recognised. These are outputted into a second data.frame that holds three entries: <code>startTime</code>, <code>endTime</code> and the <code>word</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">result</span>$<span class="no">timings</span>)
<span class="co">#'data.frame':  152 obs. of  3 variables:</span>
<span class="co"># $ startTime: chr  "0s" "0.100s" "0.500s" "0.700s" ...</span>
<span class="co"># $ endTime  : chr  "0.100s" "0.500s" "0.700s" "0.900s" ...</span>
<span class="co"># $ word     : chr  "a" "Dream" "Within" "A" ...</span>

<span class="no">result</span>$<span class="no">timings</span>
<span class="co">#     startTime endTime       word</span>
<span class="co">#1          0s  0.100s          a</span>
<span class="co">#2      0.100s  0.500s      Dream</span>
<span class="co">#3      0.500s  0.700s     Within</span>
<span class="co">#4      0.700s  0.900s          A</span>
<span class="co">#5      0.900s      1s      Dream</span></pre></body></html></div>
</div>
<div id="custom-configurations" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-configurations" class="anchor"></a>Custom configurations</h2>
<p>You can also send in other arguments which can help shape the output, such as speaker diagrization (labelling different speakers) - to use such custom configurations create a <a href="https://cloud.google.com/speech-to-text/docs/reference/rest/v1p1beta1/RecognitionConfig"><code>RecognitionConfig</code></a> object. This can be done via R lists which are converted to JSON via <code><a href="https://jeroen.cran.dev/jsonlite/reference">library(jsonlite)</a></code> and an example is shown below:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">## Use a custom configuration</span>
<span class="no">my_config</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">encoding</span> <span class="kw">=</span> <span class="st">"LINEAR16"</span>,
                  <span class="kw">diarizationConfig</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                    <span class="kw">enableSpeakerDiarization</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                    <span class="kw">minSpeakerCount</span> <span class="kw">=</span> <span class="fl">2</span>,
                    <span class="kw">maxSpeakCount</span> <span class="kw">=</span> <span class="fl">3</span>
                  ))

<span class="co"># languageCode is required, so will be added if not in your custom config</span>
<span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">my_audio</span>, <span class="kw">languageCode</span> <span class="kw">=</span> <span class="st">"en-US"</span>, <span class="kw">customConfig</span> <span class="kw">=</span> <span class="no">my_config</span>)</pre></body></html></div>
</div>
<div id="asynchronous-calls" class="section level2">
<h2 class="hasAnchor">
<a href="#asynchronous-calls" class="anchor"></a>Asynchronous calls</h2>
<p>For speech files greater than 60 seconds of if you don’t want your results straight away, set <code>asynch = TRUE</code> in the call to the API.</p>
<p>This will return an object of class <code>"gl_speech_op"</code> which should be used within the <code><a href="../reference/gl_speech_op.html">gl_speech_op()</a></code> function to check the status of the task. If the task is finished, then it will return an object the same form as the non-asynchronous case.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">async</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gl_speech.html">gl_speech</a></span>(<span class="no">test_audio</span>, <span class="kw">asynch</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">async</span>
<span class="co">## Send to gl_speech_op() for status</span>
<span class="co">## 4625920921526393240</span>

<span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gl_speech_op.html">gl_speech_op</a></span>(<span class="no">async</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://code.markedmondson.me">Mark Edmondson</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
